import os
import bait.util.testing

const ROOT_DIRS := [
	'hello_world',
	'loops'
]

const DIRS := [
	'100_doors',
]

fun run_task_tests(opts string) {
	mut runner := testing.InOutRunner{
		check_stdout = true
		cmd_options = opts
	}

	tasks_dir := os.dir($FILE)

	for rd in ROOT_DIRS {
		runner.root = os.join_path(tasks_dir, [rd])
		runner.test_all_in_root()
	}
	runner.root = tasks_dir
	for d in DIRS {
		runner.test_dir(d)
	}
}

fun test_tasks_js() {
	println('JS backend')
	run_task_tests('-b js')
}

fun test_tasks_c() {
	println('C backend')

	if os.platform() == 'win32' {
		run_task_tests('-b c -cc gcc')
		return
	}

	run_task_tests('-b c')
}
